# -*- coding: utf-8 -*-
"""store_EDA.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1aFbwRtZSEeJohEgIbGqdv_vmwbB97URU
"""

# !pip install wordcloud

# # âœ… 1ï¸âƒ£ ë‚˜ëˆ”ê³ ë”• í°íŠ¸ ì„¤ì¹˜
# !apt-get update -qq
# !apt-get install -qq fonts-nanum

# # âœ… 2ï¸âƒ£ matplotlib í°íŠ¸ ìºì‹œ ì‚­ì œ
# !rm -rf /root/.cache/matplotlib

import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
import seaborn as sns
import os

# í°íŠ¸ ê²½ë¡œ ì§ì ‘ ì§€ì •
font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'

if os.path.exists(font_path):
    fm.fontManager.addfont(font_path)
    plt.rcParams['font.family'] = 'NanumGothic'
    plt.rcParams['axes.unicode_minus'] = False
    print("âœ… í•œê¸€ í°íŠ¸ ì ìš© ì™„ë£Œ:", font_path)
else:
    print("âŒ NanumGothic.ttf íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„¤ì¹˜ í™•ì¸ í•„ìš”")

import pandas as pd
import numpy as np
from wordcloud import WordCloud
import seaborn as sns
import re

from google.colab import drive
drive.mount('/content/drive')

"""## ì‹ë‹¹ë°ì´í„°

### ë°ì´í„° íƒìƒ‰
"""

restaurant_df = pd.read_csv("/content/drive/MyDrive/Ehwa/á„á…¢á†¸á„‰á…³á„á…©á†«/1.id_v2.csv")

print(restaurant_df.shape)
print(restaurant_df.info())
restaurant_df.head(5)

# ì¤‘ë³µ í™•ì¸
print(restaurant_df['id'].duplicated().sum())
print(restaurant_df['name'].duplicated().sum())

# ê²°ì¸¡ì¹˜ í™•ì¸
restaurant_df.isna().sum()

restaurant_df['unique_key'] = restaurant_df['name'] + '_' + restaurant_df['address']
restaurant_df['unique_key'].duplicated().sum()

from geopy.distance import geodesic

# âœ… ê° ì—­ì˜ ìœ„ë„, ê²½ë„, ë°˜ê²½(ë¯¸í„°)
stations = {
    'ì„œìš¸ìˆ²ì—­': {'coord': (37.5444, 127.0443), 'radius': 700},
    'ì„±ìˆ˜ì—­': {'coord': (37.5446, 127.0565), 'radius': 700},
    'ê±´ëŒ€ì…êµ¬ì—­': {'coord': (37.5404, 127.0690), 'radius': 700}
}

# âœ… ê° ì‹ë‹¹ì˜ ì¢Œí‘œ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ ì—­ ì°¾ê¸°
def classify_region(row):
    point = (row['lat'], row['lon'])
    min_dist = float('inf')
    region = 'ê¸°íƒ€'

    for name, info in stations.items():
        dist = geodesic(point, info['coord']).m  # ë¯¸í„° ë‹¨ìœ„ ê±°ë¦¬
        if dist < min_dist:
            min_dist = dist
            region = name

    # âœ… ê° ì—­ ê³ ìœ  ë°˜ê²½ ê¸°ì¤€ìœ¼ë¡œ íŒë³„
    if min_dist <= stations[region]['radius']:
        return region
    else:
        return 'ê¸°íƒ€'

# âœ… ì ìš©
restaurant_df['region'] = restaurant_df.apply(classify_region, axis=1)

# âœ… ê²°ê³¼ í™•ì¸
region_counts = restaurant_df['region'].value_counts()
print(region_counts)

import matplotlib.pyplot as plt
import seaborn as sns

# ë°ì´í„° ì¤€ë¹„
region_counts = restaurant_df['region'].value_counts()
values = region_counts.values
labels = region_counts.index
ratios = (values / values.sum() * 100).round(1)

# ë¹„ìœ¨(ê°’)ì— ë”°ë¼ ìƒ‰ìƒ ì§„í•˜ê¸° ì¡°ì ˆ
norm = (values - values.min()) / (values.max() - values.min())
colors = [sns.color_palette("Greens", 100)[int(30 + n * 60)] for n in norm]

# autopct í•¨ìˆ˜: ë¹„ìœ¨ + ê°œìˆ˜ í•¨ê»˜ í‘œì‹œ
def make_autopct(values):
    def my_autopct(pct):
        total = sum(values)
        count = int(round(pct * total / 100.0))
        return f'{pct:.1f}%'
    return my_autopct

# ì‹œê°í™”
plt.figure(figsize=(7,7))
wedges, texts, autotexts = plt.pie(
    values,
    labels=labels,
    autopct=make_autopct(values),
    startangle=90,
    colors=colors,
    pctdistance=0.8,
    labeldistance=1.1,
    wedgeprops={'edgecolor':'white', 'linewidth':1.5}
)

# ë¼ë²¨ê³¼ í¼ì„¼íŠ¸ ê¸€ì”¨ì²´ ì¡°ì •
for text in texts:
    text.set_fontsize(12)
    text.set_fontweight('bold')
for autotext in autotexts:
    autotext.set_fontsize(11)
    autotext.set_color('black')

plt.title('700m ë°˜ê²½ ë‚´ ì‹ë‹¹ ë¹„ìœ¨ ë° ê°œìˆ˜', fontsize=15, fontweight='bold', pad=20)
plt.tight_layout()
plt.show()

import folium

folium_map = folium.Map(location=[37.545, 127.043], zoom_start=13)

for _, row in restaurant_df.dropna(subset=['lat','lon']).iterrows():
    folium.CircleMarker(
        location=[row['lat'], row['lon']],
        radius=2,
        color='green',
        fill=True,
        fill_opacity=0.5
    ).add_to(folium_map)

folium_map.save('/content/drive/MyDrive/Ehwa/á„á…¢á†¸á„‰á…³á„á…©á†«/restaurant_map.html')

def normalize_category(cat):
    if pd.isna(cat):
        return 'ê¸°íƒ€'
    cat = str(cat).strip()

    # ëŒ€í‘œ ì¹´í…Œê³ ë¦¬ ê·œì¹™
    if 'í•œì‹' in cat or 'êµ­ë°¥' in cat or 'ë°±ë°˜' in cat:
        return 'í•œì‹'
    elif 'ì¤‘ì‹' in cat or 'ì¤‘êµ­' in cat or 'ì§œì¥' in cat:
        return 'ì¤‘ì‹'
    elif 'ì¼ì‹' in cat or 'ì´ˆë°¥' in cat or 'ëˆì¹´ì¸ ' in cat or 'ì¼ë³¸' in cat:
        return 'ì¼ì‹'
    elif 'ì¹´í˜' in cat or 'ë””ì €íŠ¸' in cat or 'ì»¤í”¼' in cat:
        return 'ì¹´í˜'
    elif 'ë¶„ì‹' in cat or 'ë–¡ë³¶ì´' in cat or 'ê¹€ë°¥' in cat:
        return 'ë¶„ì‹'
    elif 'ì–‘ì‹' in cat or 'ìŠ¤í…Œì´í¬' in cat or 'ì´íƒˆ' in cat or 'í”¼ì' in cat or 'íŒŒìŠ¤íƒ€' in cat:
        return 'ì–‘ì‹'
    elif 'ì•„ì‹œì•„' in cat or 'íƒœêµ­' in cat or 'ë² íŠ¸ë‚¨' in cat:
        return 'ì•„ì‹œì•ˆ'
    elif 'íŒ¨ìŠ¤íŠ¸' in cat or 'ë²„ê±°' in cat:
        return 'íŒ¨ìŠ¤íŠ¸í‘¸ë“œ'
    elif 'ê³ ê¸°' in cat or 'ì‚¼ê²¹' in cat or 'ì†Œê³ ê¸°' in cat or 'ë¼ì§€' in cat:
        return 'ê³ ê¸°/êµ¬ì´'
    elif 'ìˆ ' in cat or 'í¬ì°¨' in cat or 'ì£¼ì ' in cat or 'ë°”' in cat:
        return 'ì£¼ì '
    else:
        return 'ê¸°íƒ€'

restaurant_df['category_clean'] = restaurant_df['category_1'].apply(normalize_category)
top_categories = restaurant_df['category_clean'].value_counts().head(15)

plt.figure(figsize=(9,6))
ax = sns.barplot(
    x=top_categories.values,
    y=top_categories.index,
    color='#006400'  # ì§„í•œ ì´ˆë¡ìƒ‰
)

plt.title('ìƒìœ„ 15ê°œ ì¹´í…Œê³ ë¦¬ë³„ ì‹ë‹¹ ìˆ˜', fontsize=14, weight='bold')
plt.xlabel('ì‹ë‹¹ ìˆ˜', fontsize=12)
plt.ylabel('ì¹´í…Œê³ ë¦¬', fontsize=12)

# ë¹„ìœ¨ ê³„ì‚°
category_ratio = (top_categories / top_categories.sum() * 100).round(1)

# âœ… ê°œìˆ˜ + ë¹„ìœ¨ì„ ê°™ì´ í‘œì‹œ
for i, (v, r) in enumerate(zip(top_categories.values, category_ratio.values)):
    ax.text(v + 10, i, f'{v} ({r}%)', color='black', va='center', fontsize=11)

plt.tight_layout()
plt.show()

# region_counts = restaurant_df['region'].value_counts()
# sns.barplot(x=region_counts.values, y=region_counts.index, palette="Greens_r")
# plt.title("700m ë°˜ê²½ ë‚´ ì§€ì—­ë³„ ì‹ë‹¹ ìˆ˜", fontsize=14, fontweight="bold")
# plt.xlabel("ì‹ë‹¹ ìˆ˜"); plt.ylabel("ì§€ì—­")

# ratio = (region_counts / region_counts.sum() * 100).round(1)
# for i, (v, r) in enumerate(zip(region_counts.values, ratio.values)):
#     plt.text(v + 10, i, f"{v}ê°œ ({r}%)", va='center', fontsize=10)
# plt.show()

plt.figure(figsize=(8,6))
sns.heatmap(pivot.T, annot=True, fmt='.1f', cmap='Greens', cbar_kws={'label':'ë¹„ìœ¨(%)'})
plt.title('ì§€ì—­ë³„ ì—…ì¢… ë¹„ìœ¨ íˆíŠ¸ë§µ', fontsize=14, fontweight='bold')
plt.xlabel('ì§€ì—­')
plt.ylabel('ì—…ì¢…')
plt.tight_layout()
plt.show()

from math import pi

categories = list(pivot.columns)
num_categories = len(categories)

for region in pivot.index:
    values = pivot.loc[region].tolist()
    values += values[:1]  # ë‹«ê¸°ìš©
    angles = [n / float(num_categories) * 2 * pi for n in range(num_categories)]
    angles += angles[:1]

    plt.polar(angles, values, label=region)

plt.xticks([n / float(num_categories) * 2 * pi for n in range(num_categories)], categories, fontsize=9)
plt.title('ì§€ì—­ë³„ ì—…ì¢… ë¹„ìœ¨ ë¹„êµ (Radar Chart)', fontsize=14, fontweight='bold')
plt.legend(bbox_to_anchor=(1.05,1), loc='upper left')
plt.show()



"""## ë¦¬ë·°ë°ì´í„°"""

review_df = pd.read_csv("/content/drive/MyDrive/Ehwa/á„á…¢á†¸á„‰á…³á„á…©á†«/4. review_kakaogoogle_á„Œá…¥á†¼á„’á…ª.csv")

print(review_df.shape)
print(review_df.info())
review_df.head(5)

import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np

plt.figure(figsize=(8,5))
sns.histplot(review_df['rating'], bins=np.arange(0.5, 5.6, 1), kde=True,
             color='#2E8B57', edgecolor='black', alpha=0.6)

mean_rating = review_df['rating'].mean()
plt.axvline(mean_rating, color='red', linestyle='--', linewidth=2)
plt.text(mean_rating+0.1, 6000, f'í‰ê·  {mean_rating:.2f}ì ', color='red', fontsize=12)
plt.title('ë¦¬ë·° í‰ì ì˜ ë¶„í¬', fontsize=14, fontweight='bold', pad=15)
plt.xlabel('í‰ì ', fontsize=12)
plt.ylabel('ë¦¬ë·° ê°œìˆ˜', fontsize=12)
plt.xticks([1,2,3,4,5], ['1ì ', '2ì ', '3ì ', '4ì ', '5ì '])

counts = review_df['rating'].value_counts(normalize=True).sort_index()
for rating, ratio in counts.items():
    plt.text(rating, ratio * len(review_df) + 300, f'{ratio*100:.1f}%',
             ha='center', va='bottom', fontsize=10, color='black')

plt.tight_layout()
plt.show()

from datetime import datetime, timedelta

# êµ¬ê¸€ ìƒëŒ€ì  ë‚ ì§œë¥¼ ì‹¤ì œ ë‚ ì§œë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
def convert_google_relative_date(relative_date_str, reference_date="2025-10-18"):
    if pd.isna(relative_date_str):
        return None

    try:
        relative_date_str = str(relative_date_str).strip()
        ref_date = datetime.strptime(reference_date, '%Y-%m-%d')

        import re

        year_match = re.search(r'(\d+)ë…„\s*ì „', relative_date_str)
        if year_match:
            years = int(year_match.group(1))
            actual_date = ref_date - timedelta(days=years * 365)
            return actual_date.strftime('%Y-%m-%d')
        month_match = re.search(r'(\d+)ë‹¬\s*ì „', relative_date_str)
        if month_match:
            months = int(month_match.group(1))
            # ëŒ€ëµì ìœ¼ë¡œ 1ë‹¬ = 30ì¼ë¡œ ê³„ì‚°
            actual_date = ref_date - timedelta(days=months * 30)
            return actual_date.strftime('%Y-%m-%d')
        week_match = re.search(r'(\d+)ì£¼\s*ì „', relative_date_str)
        if week_match:
            weeks = int(week_match.group(1))
            actual_date = ref_date - timedelta(weeks=weeks)
            return actual_date.strftime('%Y-%m-%d')
        day_match = re.search(r'(\d+)ì¼\s*ì „', relative_date_str)
        if day_match:
            days = int(day_match.group(1))
            actual_date = ref_date - timedelta(days=days)
            return actual_date.strftime('%Y-%m-%d')
        if 'ì–´ì œ' in relative_date_str:
            actual_date = ref_date - timedelta(days=1)
            return actual_date.strftime('%Y-%m-%d')
        if 'ì˜¤ëŠ˜' in relative_date_str:
            return ref_date.strftime('%Y-%m-%d')
        if '.' in relative_date_str or '-' in relative_date_str:
            if '.' in relative_date_str:
                return datetime.strptime(relative_date_str, '%Y.%m.%d').strftime('%Y-%m-%d')
            elif '-' in relative_date_str:
                return datetime.strptime(relative_date_str, '%Y-%m-%d').strftime('%Y-%m-%d')

        return None

    except:
        return None

print("êµ¬ê¸€ ìƒëŒ€ì  ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜ ì •ì˜ ì™„ë£Œ")

# ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ (êµ¬ê¸€/ì¹´ì¹´ì˜¤ êµ¬ë¶„) - ì‹¤ì œ ë‚ ì§œë¡œ ë³€í™˜
def convert_to_actual_date(date_str, site, reference_date="2025-10-18"):
    """
    ë‚ ì§œë¥¼ ì‹¤ì œ ë‚ ì§œë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
    êµ¬ê¸€ì˜ ê²½ìš° ìƒëŒ€ì  ë‚ ì§œë¥¼ ë¨¼ì € ì‹¤ì œ ë‚ ì§œë¡œ ë³€í™˜
    """
    if pd.isna(date_str):
        return None

    try:
        if site == 'google':
            actual_date_str = convert_google_relative_date(date_str, reference_date)
            if actual_date_str is None:
                return None
            return actual_date_str
        else:
            date_str_clean = str(date_str).strip()
            if date_str_clean.endswith('.'):
                date_str_clean = date_str_clean[:-1]

            if '.' in date_str_clean:
                date_obj = datetime.strptime(date_str_clean, '%Y.%m.%d')
                return date_obj.strftime('%Y-%m-%d')
            elif '-' in date_str_clean:
                date_obj = datetime.strptime(date_str_clean, '%Y-%m-%d')
                return date_obj.strftime('%Y-%m-%d')
            else:
                return None

    except:
        return None

print("ìˆ˜ì •ëœ ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜ ì •ì˜ ì™„ë£Œ")

review_df['actual_date'] = review_df.apply(lambda row: convert_to_actual_date(row['date'], row['site']), axis=1)

review_df.head(5)

review_df['actual_date'] = pd.to_datetime(review_df['actual_date'])
review_df.groupby(review_df['actual_date'].dt.to_period('M')).size().plot()

restaurant_df['length'] = restaurant_df['review'].str.len()
sns.histplot(restaurant_df['length'])

# !pip install konlpy jpype1

from wordcloud import WordCloud
from collections import Counter
from konlpy.tag import Okt
import matplotlib.pyplot as plt
import seaborn as sns
import os
import matplotlib.font_manager as fm

# âœ… 1. ë¦¬ë·°ëŠ” ì´ê±¸ë¡œ!
text = ' '.join(review_df['review'].dropna())

# âœ… 2. í˜•íƒœì†Œ ë¶„ì„
okt = Okt()
words = [w for w in okt.nouns(text) if len(w) > 1]

freq = Counter(words)

fig, axes = plt.subplots(1, 2, figsize=(14, 6))

# âœ… 3. ì›Œë“œí´ë¼ìš°ë“œ

# í°íŠ¸ ê²½ë¡œ ì§ì ‘ ì§€ì • (Added this line)
font_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
if os.path.exists(font_path):
    fm.fontManager.addfont(font_path) # Ensure font is added if path is valid
    plt.rcParams['font.family'] = 'NanumGothic'
    plt.rcParams['axes.unicode_minus'] = False
else:
    print("âŒ NanumGothic.ttf íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„¤ì¹˜ í™•ì¸ í•„ìš”")


wordcloud = WordCloud(
    font_path=font_path,
    background_color='white',
    width=1000, height=600,
    colormap='RdYlGn',
    max_words=100
).generate_from_frequencies(freq)

axes[0].imshow(wordcloud, interpolation='bilinear')
axes[0].axis('off')
axes[0].set_title('ë¦¬ë·° í‚¤ì›Œë“œ ì›Œë“œí´ë¼ìš°ë“œ', fontsize=15, fontweight='bold')
# axes[0].show()

# (ì„ íƒ) ìƒìœ„ 20ê°œ ë§‰ëŒ€ê·¸ë˜í”„
top_20_words = freq.most_common(20)
words_, counts_ = zip(*top_20_words)

sns.barplot(x=counts_, y=words_, palette='Greens_r', ax=axes[1])
axes[1].set_title('ë¦¬ë·° ìƒìœ„ 20ê°œ ë‹¨ì–´', fontsize=13, fontweight='bold')
axes[1].set_xlabel('ë“±ì¥ ë¹ˆë„')


plt.tight_layout()
plt.show()

plt.figure(figsize=(8,6))
sns.regplot(
    data=restaurant_df, x='length', y='rating',
    scatter_kws={'alpha':0.2, 'color':'#2E8B57', 's':40},
    line_kws={'color':'#E74C3C', 'linewidth':2},
)
plt.title('ë¦¬ë·° ê¸¸ì´ì— ë”°ë¥¸ í‰ì  ê²½í–¥', fontsize=15, fontweight='bold', pad=15)
plt.xlabel('ë¦¬ë·° ê¸¸ì´(ë¬¸ì ìˆ˜)', fontsize=12)
plt.ylabel('í‰ì ', fontsize=12)
plt.grid(alpha=0.3)
plt.tight_layout()
plt.show()

corr = restaurant_df['length'].corr(restaurant_df['rating'])
print(f"ğŸ“ˆ ë¦¬ë·° ê¸¸ì´ì™€ í‰ì ì˜ ìƒê´€ê³„ìˆ˜: {corr:.3f}")

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd

# ë„ˆë¬´ ê¸´ ë¦¬ë·°ëŠ” ì œì™¸ (outlier ì œê±°ìš©)
filtered = restaurant_df[restaurant_df['length'] < 1000]

# ë¦¬ë·° ê¸¸ì´ë¥¼ 20ì ë‹¨ìœ„ êµ¬ê°„ìœ¼ë¡œ ë‚˜ëˆ„ê¸°
filtered['length_bin'] = (filtered['length'] // 20) * 20

# ê° êµ¬ê°„ë³„ í‰ê·  í‰ì  ê³„ì‚°
avg_rating = filtered.groupby('length_bin')['rating'].mean().reset_index()

plt.figure(figsize=(8,5))
sns.lineplot(data=avg_rating, x='length_bin', y='rating', marker='o', color='#2E8B57')

plt.title('ë¦¬ë·° ê¸¸ì´ì— ë”°ë¥¸ í‰ê·  í‰ì  ë³€í™”', fontsize=14, fontweight='bold', pad=15)
plt.xlabel('ë¦¬ë·° ê¸¸ì´ êµ¬ê°„ (ë¬¸ì ìˆ˜)')
plt.ylabel('í‰ê·  í‰ì ')
plt.grid(alpha=0.3)
plt.tight_layout()
plt.show()

import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd
import numpy as np

plt.rcParams['font.family'] = 'NanumGothic'
plt.rcParams['axes.unicode_minus'] = False

# 1ï¸âƒ£ íšŒê·€ì„  ê·¸ë˜í”„ (ì „ì²´ ê²½í–¥)
fig, axes = plt.subplots(1, 2, figsize=(14, 6))

sns.regplot(
    data=restaurant_df,
    x='length', y='rating',
    scatter_kws={'alpha':0.2, 'color':'#2E8B57', 's':40},
    line_kws={'color':'#E74C3C', 'linewidth':2},
    ax=axes[0]
)
axes[0].set_title('ë¦¬ë·° ê¸¸ì´ì— ë”°ë¥¸ í‰ì  ê²½í–¥', fontsize=14, fontweight='bold', pad=15)
axes[0].set_xlabel('ë¦¬ë·° ê¸¸ì´(ë¬¸ì ìˆ˜)', fontsize=12)
axes[0].set_ylabel('í‰ì ', fontsize=12)
axes[0].grid(alpha=0.3)

# 2ï¸âƒ£ ë¦¬ë·° ê¸¸ì´ êµ¬ê°„ë³„ í‰ê·  ê·¸ë˜í”„
restaurant_df['length_bin'] = (restaurant_df['length'] // 20) * 20
avg_by_length = restaurant_df.groupby('length_bin')['rating'].mean().reset_index()

axes[1].plot(avg_by_length['length_bin'], avg_by_length['rating'],
             marker='o', color='#2E8B57', linewidth=1.5)
axes[1].set_title('ë¦¬ë·° ê¸¸ì´ì— ë”°ë¥¸ í‰ê·  í‰ì  ë³€í™”', fontsize=14, fontweight='bold', pad=15)
axes[1].set_xlabel('ë¦¬ë·° ê¸¸ì´ êµ¬ê°„ (ë¬¸ì ìˆ˜)', fontsize=12)
axes[1].set_ylabel('í‰ê·  í‰ì ', fontsize=12)
axes[1].grid(alpha=0.3)

# 3ï¸âƒ£ ì „ì²´ ìŠ¤íƒ€ì¼ ì •ë¦¬
plt.suptitle('ë¦¬ë·° ê¸¸ì´ì— ë”°ë¥¸ í‰ì  ë³€í™” ë¶„ì„', fontsize=16, fontweight='bold', y=1.02)
plt.tight_layout()
plt.show()

plt.figure(figsize=(8,6))
sns.boxplot(
    x='site', y='rating', data=review_df,
    palette=['#81C784', '#1B5E20'],
    width=0.6, showmeans=True,
    meanprops={'marker':'o', 'markerfacecolor':'red', 'markeredgecolor':'black'},
    medianprops={'color':'yellow', 'linewidth':2}
)

summary = review_df.groupby('site')['rating'].agg(['mean','median','count']).round(2)
labels = [f"{site} ({int(row['count'])}ê°œ)" for site, row in summary.iterrows()]


for i, (site, row) in enumerate(summary.iterrows()):
    plt.text(i, row['mean'] + 0.05, f"í‰ê·  {row['mean']:.2f}", color='red', fontsize=11, fontweight='bold', ha='center')
    plt.text(i, row['median'] - 0.35, f"ì¤‘ì•™ê°’ {row['median']:.2f}", color='gold', fontsize=10, ha='center')

plt.title('í”Œë«í¼ë³„ ë¦¬ë·° í‰ì  ë¶„í¬ ë¹„êµ', fontsize=15, fontweight='bold', pad=20)
plt.xlabel('ë¦¬ë·° í”Œë«í¼', fontsize=12)
plt.ylabel('í‰ì ', fontsize=12)
plt.xticks(range(len(labels)), labels, fontsize=12)
plt.yticks([1,2,3,4,5], ['1ì ','2ì ','3ì ','4ì ','5ì '])
plt.grid(axis='y', linestyle='--', alpha=0.3)

plt.tight_layout()
plt.show()

